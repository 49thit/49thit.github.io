<nav class="post-nav" aria-label="Episodes">
  <button
    class="post-nav__toggle"
    type="button"
    aria-expanded="false"
    aria-controls="post-nav-list"
  >
    episodes...
    <span class="post-nav__icon" aria-hidden="true"></span>
  </button>
  {% assign posts_with_episode = site.posts | where_exp: "p", "p.episode" %}
  {% if posts_with_episode and posts_with_episode.size > 0 %}
    {% assign episodes = site.posts | sort: "episode" | reverse %}
  {% else %}
    {% assign episodes = site.posts | sort: "title" | reverse %}
  {% endif %}
  <ul id="post-nav-list" aria-hidden="false">
    {% for post in episodes %}
      <li>
        {% if post.url == page.url %}
          <span class="post-nav__link" aria-current="page">{{ post.title }}</span>
        {% else %}
          <a class="post-nav__link" href="{{ post.url | relative_url }}">{{ post.title }}</a>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.querySelector(".post-nav__toggle");
    const list = document.getElementById("post-nav-list");
    if (!toggle || !list) return;

    function setExpanded(expanded) {
      toggle.setAttribute("aria-expanded", expanded.toString());
      list.classList.toggle("is-open", expanded);
      list.setAttribute("aria-hidden", (!expanded).toString());
    }

    // Initialize ARIA state to match current expansion and CSS
    let initialExpanded = toggle.getAttribute("aria-expanded") === "true";
    try {
      const computed = window.getComputedStyle(list);
      if (computed && computed.display !== "none") {
        initialExpanded = true;
      }
    } catch (e) {}
    setExpanded(initialExpanded);

    function onActivate(event) {
      if (event.type === "keydown" && event.key !== "Enter" && event.key !== " ") {
        return;
      }
      event.preventDefault();
      const isExpanded = toggle.getAttribute("aria-expanded") === "true";
      setExpanded(!isExpanded);
    }

    toggle.addEventListener("click", onActivate);
    toggle.addEventListener("keydown", onActivate);
  });
</script>

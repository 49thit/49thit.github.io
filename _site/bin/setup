#!/usr/bin/env bash
set -euo pipefail
ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT"

if command -v bundle >/dev/null 2>&1; then
  echo "==> Installing Ruby gems"
  bundle config set path 'vendor/bundle'
  bundle install --quiet
else
  echo "Bundler is not installed. Install Ruby + bundler to continue." >&2
fi

if [ -f "$ROOT/package.json" ]; then
  if command -v npm >/dev/null 2>&1; then
    echo "==> Installing Node dependencies"
    npm install >/dev/null
    echo "==> Building JavaScript bundle"
    npm run build:js >/dev/null
  else
    echo "npm is not available; skipping JavaScript build" >&2
  fi
fi

if [ -x "$ROOT/bin/setup.local" ]; then
  "$ROOT/bin/setup.local"
fi
